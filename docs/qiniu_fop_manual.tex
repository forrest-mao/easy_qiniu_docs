\documentclass[11pt, oneside]{book}
\usepackage{geometry}
\geometry{a4paper}

\usepackage{CJKutf8}

\usepackage{graphicx}
\usepackage{indentfirst}
\usepackage[colorlinks,urlcolor=blue]{hyperref}

\usepackage{listings}
\lstset{basicstyle=\ttfamily}

\newcommand{\qpar}[1]{
\vspace{0.25em}
\noindent
#1\par
\vspace{0.25em}
}

\newcommand{\qurl}[1]{\url{#1}}

\newcommand{\qqbox}[1]{\hspace{0.2em}\fbox{#1}\hspace{0.2em}}

\newcommand{\qtable}[1]{\vspace{0.5em}#1\vspace{0.5em}}

\title{七牛云存储 \\ 云处理使用指南}
\author{梁涛 @七牛云存储}
\date{2013-08-19}

\begin{document}

\begin{CJK*}{UTF8}{song}
\maketitle

\chapter{图片处理}

\section{获取图片信息}

\subsection{获取基本信息}

\qpar{在图片下载URL后附加\qqbox{imageInfo}指示符（区分大小写），可以获取JSON格式的图片基本信息，包括图片格式、宽高值（单位：像素）、色彩模型。}
\qpar{注意：缩略图不支持该方法。}

\qpar{示例（点击查看效果）：}
\qpar{\qurl{http://qiniuphotos.qiniudn.com/gogopher.jpg}}
\qpar{$\Rightarrow$}
\qpar{\qurl{http://qiniuphotos.qiniudn.com/gogopher.jpg?imageInfo}}

\qpar{返回结果：}
\begin{verbatim}
{
   "format":     "jpeg",
   "width":      640,     // 像素
   "height":     427,     // 像素
   "colorModel": "ycbcr"
}
\end{verbatim}

\clearpage

\subsection{获取EXIF信息}

\qpar{EXIF（EXchangeable Image File Format），是专门为数码相机的照片设定的可交换图像文件格式，
详见\href{http://zh.wikipedia.org/wiki/EXIF}{维基百科}。}
\qpar{获取方式为在图片下载URL后附加\qqbox{exif}指示符（区分大小写）。}
\qpar{注意：缩略图不支持该方法。}

\qpar{示例（点击查看效果）：}
\qpar{\qurl{http://qiniuphotos.qiniudn.com/gogopher.jpg}}
\qpar{$\Rightarrow$}
\qpar{\qurl{http://qiniuphotos.qiniudn.com/gogopher.jpg?exif}}

\qpar{返回结果：}
\begin{verbatim}
{
   "DateTime" : {
      "type" : 2,
      "val" : "2011:11:19 17:09:23"
   },
   "ExposureBiasValue" : {
      "type" : 10,
      "val" : "0.33 EV"
   },
   "ExposureTime" : {
      "type" : 5,
      "val" : "1/50 sec."
   },
   "Model" : {
      "type" : 2,
      "val" : "Canon EOS 600D"
   },
   "ISOSpeedRatings" : {
      "type" : 3,
      "val" : "3200"
   },
   "ResolutionUnit" : {
      "type" : 3,
      "val" : "英寸"
   },
   ...其余略...
}
\end{verbatim}

\clearpage

\section{生成缩略图}

\qpar{在图片下载URL后附加\qqbox{imageView}指示符（区分大小写）并指定缩略规格，可以生成该图片的缩略图。}
\qpar{调用接口：}
\begin{lstlisting}[basicstyle=\ttfamily\footnotesize]
<URL>?imageView/<mode>/w/<width>/h/<height>/q/<quality>/format/<format>
\end{lstlisting}

%\begin{verbatim}
%<URL>?imageView/<mode>/w/<width>/h/<height>/q/<quality>/format/<format>
%     |________||_____||________||_________||__________||______________|
%          |       |        |         |           |            |
% 指示符 --+       |        |         |           |            |
%                  |        |         |           |            |
% 缩略模式 --------+        |         |           |            |
%                           |         |           |            |
% 缩略宽度（像素） ---------+         |           |            |
%                                     |           |            |
% 缩略高度（像素） -------------------+           |            |
%                                                 |            |
% 缩略质量（取值1-100） --------------------------+            |
%                                                              |
% 图片格式（支持jpg、gif、webp等） ----------------------------+
%\end{verbatim}

\qpar{参数说明：}
\qtable{
\def\arraystretch{1.5}
\begin{tabular}{|l|l|l|}
\hline
名称 & 说明 & 备注\\
\hline
\textless mode\textgreater & 处理模式 & \\
\hline
\textless width\textgreater & 缩略宽度，单位：像素（px） & \\
\hline
\textless height\textgreater & 缩略高度，单位：像素（px） & \\
\hline
\textless quality\textgreater & 图片质量，取值范围1－100 & 可选，缺省为85 \\
\hline
\textless format\textgreater & 图片格式，支持jpg、gif、png、webp等 & 可选，缺省为原图格式 \\
\hline
\end{tabular}
}

\qpar{其中\textless mode\textgreater分为如下4种情况：}
\qtable{
\def\arraystretch{1.5}
\begin{tabular}{|l|p{22em}|l|}
\hline
模式 & 说明 & 备注 \\
\hline
\textless mode\textgreater=1 & 同时限定宽度和高度，从原图居中位置按比例裁切，生成\textless width\textgreater x\textless height\textgreater 大小的缩略图。& 参看示例1 \\
\hline
\textless mode\textgreater=2 & 同时限定宽度和高度，原图完整缩放为\textless width\textgreater x\textless height\textgreater 大小的缩略图。& 参看示例2 \\
\hline
\textless mode\textgreater=2 & 仅限定宽度，高度等比自适应缩放。 & 参看示例3 \\
\hline
\textless mode\textgreater=2 & 仅限定高度，宽度等比自适应缩放。 & 参看示例4 \\
\hline
\end{tabular}
}

\clearpage

\qpar{示例1，居中裁切生成200x200缩略图（点击查看效果）：}
\qpar{\qurl{http://qiniuphotos.qiniudn.com/gogopher.jpg}}
\qpar{$\Rightarrow$}
\qpar{\qurl{http://qiniuphotos.qiniudn.com/gogopher.jpg?imageView/1/w/200/h/200}}

\begin{center}
\includegraphics[scale=0.7]{../pics/gogopher_imageView_1_200x200.png}
\end{center}

%\qpar{生成步骤：}
%\begin{enumerate}
%    \item 按指定的200x200尺寸，等比例生成一个427x427的选区，与原图短边（即高度）一致；
%    \item 将选区居中对齐原图，切出选区部分，等比例缩略至200x200。
%\end{enumerate}

\end{CJK*}

\end{document}
